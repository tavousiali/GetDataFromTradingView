function downloadObjectAsJson(exportObj, exportName) {
  var dataStr =
    "data:text/json;charset=utf-8," +
    encodeURIComponent(JSON.stringify(exportObj));
  var downloadAnchorNode = document.createElement("a");
  downloadAnchorNode.setAttribute("href", dataStr);
  downloadAnchorNode.setAttribute("download", exportName + ".json");
  document.body.appendChild(downloadAnchorNode);
  downloadAnchorNode.click();
  downloadAnchorNode.remove();
}

const exportDataCallback = (symbol, exportDataResult, i) => {
  const result = [];

  const openIndex = exportDataResult.schema.findIndex(
    (y) => y.plotTitle === "open"
  );
  const highIndex = exportDataResult.schema.findIndex(
    (y) => y.plotTitle === "high"
  );
  const lowIndex = exportDataResult.schema.findIndex(
    (y) => y.plotTitle === "low"
  );
  const closeIndex = exportDataResult.schema.findIndex(
    (y) => y.plotTitle === "close"
  );
  const volumeIndex = exportDataResult.schema.findIndex(
    (y) => y.plotTitle === "Volume"
  );
  const timeIndex = exportDataResult.schema.findIndex((y) => y.type === "time");
  const zigZagIndex = exportDataResult.schema.findIndex(
    (y) => y.sourceTitle?.indexOf("Zig Zag") > -1
  );
  const rsiIndex = exportDataResult.schema.findIndex(
    (y) => y.sourceTitle?.indexOf("Relative Strength Index") > -1
  );
  const macdIndex = exportDataResult.schema.findIndex(
    (y) => y.plotTitle?.indexOf("MACD") > -1
  );
  const signalIndex = exportDataResult.schema.findIndex(
    (y) => y.plotTitle?.indexOf("Signal") > -1
  );
  const histogramIndex = exportDataResult.schema.findIndex(
    (y) => y.plotTitle?.indexOf("Histogram") > -1
  );

  exportDataResult.data.forEach((y) => {
    const data = {
      time: y[timeIndex],
      persianDate: new Date(y[timeIndex] * 1000).toLocaleDateString("fa-IR"),
      date: new Date(y[timeIndex] * 1000),
      open: y[openIndex],
      high: y[highIndex],
      low: y[lowIndex],
      close: y[closeIndex],
      volume: y[volumeIndex],
      rsi: y[rsiIndex],
      macd: y[macdIndex],
      signal: y[signalIndex],
      histogram: y[histogramIndex],
      zigzag: y[zigZagIndex],
    };

    result.push(data);
  });

  downloadObjectAsJson(result, symbol);

  i = i + 1;
  loadChartAndGetData(i);
};

const getData = (symbol, callback, i) =>
  tvWidget
    .activeChart()
    .exportData()
    .then((exportDataResult) => {
      callback(symbol, exportDataResult, i);
    });

const loadChartAndGetData = (i) => {
  const symbol = symbols[i];
  tvWidget.activeChart().setSymbol(symbol);

  tvWidget
    .activeChart()
    .onDataLoaded()
    .subscribe(
      null,
      () => {
        setTimeout(() => {
          getData(symbol, exportDataCallback, i);
        }, 5000);
      },
      true
    );
};

let symbols = [
  "زمگسا",
  "کطبس",
  "کچاد",
  "کگل",
  "ومعادن",
  "کبافق",
  "کدما",
  "کروی",
  "کمنگنز",
  "کاما",
  "کماسه",
  "غشهد",
  "غنوش",
  "غدشت",
  "غاذر",
  "غمارگ",
  "غبشهر",
  "بهپاک",
  "غناب",
  "وبشهر",
  "غپاک",
  "غشصفا",
  "غشاذر",
  "غالبر",
  "غشان",
  "غگل",
  "غدام",
  "غگرجی",
  "غویتا",
  "غیوان",
  "غسالم",
  "قنیشا",
  "قیستو",
  "قشرین",
  "قثابت",
  "قنقش",
  "قمرو",
  "قلرست",
  "قهکمت",
  "قپیرا",
  "قجام",
  "قشکر",
  "قصفها",
  "قشهد",
  "قشیر",
  "قزوین",
  "غپینو",
  "غصینو",
  "غشوکو",
  "غچین",
  "غمهرا",
  "غبهنوش",
  "نمرینو",
  "نبروج",
  "نتوس",
  "وملی",
  "چفیبر",
  "چنوپا",
  "چکاوه",
  "چکارن",
  "چکارم",
  "چافست",
  "شنفت",
  "شبهرن",
  "شزنگ",
  "ونفت",
  "شفارا",
  "شاملا",
  "شیران",
  "شمواد",
  "شسینا",
  "شخارک",
  "شصفها",
  "شاراک",
  "شفارس",
  "شکلر",
  "شیراز",
  "شپترو",
  "شملی",
  "شسم",
  "شرنگی",
  "شلعاب",
  "دجابر",
  "دابور",
  "دکیمی",
  "درازک",
  "دلقما",
  "داسوه",
  "وپخش",
  "دکوثر",
  "دشیری",
  "ددام",
  "شتهران",
  "دپارس",
  "دفارا",
  "دامین",
  "دسینا",
  "دالبر",
  "دعبید",
  "دتهران",
  "دفرا",
  "دلر",
  "دزهراوی",
  "دقاضی",
  "دیران",
  "دارو",
  "دتماد",
  "دشیمی",
  "دسبحا",
  "دروز",
  "والبر",
  "شکف",
  "شپارس",
  "شپاکسا",
  "شتولی",
  "شگل",
  "شکربن",
  "شدوص",
  "وپترو",
  "شپلی",
  "پتایر",
  "پکرمان",
  "پاسا",
  "پیزد",
  "پارتا",
  "پسهند",
  "پشاهن",
  "پلاست",
  "پلاسک",
  "پدرخش",
  "پلوله",
  "کقزوی",
  "کپشیر",
  "کگاز",
  "کهمدا",
  "کابگن",
  "کساپا",
  "کسرام",
  "کفرا",
  "کرازی",
  "کسرا",
  "کفپارس",
  "کاذر",
  "کسعدی",
  "کپارس",
  "کحافظ",
  "کلوند",
  "کساوه",
  "کترام",
  "کهرام",
  "ستران",
  "سشمال",
  "سکرما",
  "سصوفی",
  "سفارس",
  "سشرق",
  "سخزر",
  "سغرب",
  "سمازن",
  "ساروم",
  "سپاها",
  "سقاین",
  "سرود",
  "سدور",
  "سهگمت",
  "سبهان",
  "سخاش",
  "سکارون",
  "سصفها",
  "ساربیل",
  "سیلام",
  "ساوه",
  "سبجنو",
  "سهرمز",
  "سفار",
  "ساراب",
  "سپرمی",
  "سایرا",
  "ساذری",
  "کایتا",
  "سفاسی",
  "سفارود",
  "کخاک",
  "کورز",
  "فاهواز",
  "فپنتا",
  "فنورد",
  "فلوله",
  "فروس",
  "فسپا",
  "فروژ",
  "فوکا",
  "فسدید",
  "فجر",
  "وسدید",
  "وتوکا",
  "فالوم",
  "فنوال",
  "فباهنر",
  "فاسمین",
  "فایرا",
  "فسرب",
  "فرآور",
  "فمراد",
  "فاراک",
  "تکنو",
  "فلامی",
  "فبیرا",
  "فاما",
  "فاذر",
  "فنرژی",
  "فجام",
  "فبستم",
  "فجوش",
  "خبنیان",
  "تپمپی",
  "تاتمس",
  "تفیرو",
  "تمحرکه",
  "لابسا",
  "لسرما",
  "تشتاد",
  "تکمبا",
  "تایرا",
  "تکشا",
  "تپکو",
  "لخانه",
  "لخزر",
  "لازما",
  "لبوتان",
  "وتوشه",
  "بموتو",
  "بترانس",
  "بنیرو",
  "بسویچ",
  "بالبر",
  "بتک",
  "بایکا",
  "بکاب",
  "بکام",
  "بشهاب",
  "لکما",
  "لپارس",
  "لپیام",
  "خاور",
  "خودرو",
  "خبهمن",
  "خکاوه",
  "خساپا",
  "خزامیا",
  "خپارس",
  "خموتور",
  "ورنا",
  "خلنت",
  "ختوقا",
  "خمحرکه",
  "خچرخش",
  "خوساز",
  "خزر",
  "خریخت",
  "ختور",
  "خفنر",
  "خکمک",
  "خکار",
  "خاهن",
  "ختراک",
  "خاذین",
  "خشرق",
  "خرینگ",
  "خمهر",
  "خمحور",
  "وغدیر",
  "وصندوق",
  "خپویش",
  "خنصیر",
  "وبانک",
  "خصدرا",
  "حرهشا",
  "حپترو",
  "حتوکا",
  "حتاید",
  "وکار",
  "ونوین",
  "وسینا",
  "وپارس",
  "ولیز",
  "ولصنم",
  "ونیکی",
  "وسپه",
  "وملت",
  "وصنعت",
  "وتوصا",
  "وبیمه",
  "وبوعلی",
  "وصنا",
  "ونیرو",
  "ثامان",
  "رتکو",
  "وبهمن",
  "واتی",
  "وتوسم",
  "وساخت",
  "ثاصفا",
  "وتوس",
  "وآذر",
  "ثمسکن",
  "ثفارس",
  "ثنوسا",
  "رانفور",
  "مداران",
  "آباد",
  "ثاخت",
  "وثخوز",
  "ثاژن",
  "رمپنا",
  "سنیر",
  "ولساپا",
  "ولغدر",
  "مرقام",
  "ثشاهد",
  "خگستر",
  "فملی",
  "فولاد",
  "سدشت",
  "تراک",
  "حکشتی",
  "فخاس",
  "فخوز",
  "شبریز",
  "شپنا",
  "شفن",
  "وامید",
  "سکرد",
  "وپاسار",
  "سامان",
  "وتجارت",
  "وبصادر",
  "وبملت",
  "پارسیان",
  "البرز",
  "بساما",
  "ملت",
  "وآفری",
  "سمایه",
  "بپاس",
  "ذوب",
  "اخابر",
  "شپاس",
  "آسیا",
  "ودی",
  "ومعلم",
  "نوین",
  "دانا",
  "وحافظ",
  "ورازی",
  "وسین",
  "حفاری",
  "سفانو",
  "سآبیک",
  "کمرجان",
  "پکویر",
  "وساپا",
  "میهن",
  "وپست",
  "ثعمرا",
  "رتاپ",
  "بالاس",
  "وایران",
  "فولاژ",
  "دسبحان",
  "وگستر",
  "همراه",
  "سبزوا",
  "وخارزم",
  "شکبیر",
  "شپدیس",
  "دی",
  "حفارس",
  "فولای",
  "افرا",
  "زاگرس",
  "ددانا",
  "سمگا",
  "وگردش",
  "کرماشا",
  "ثباغ",
  "وزمین",
  "آ س پ",
  "میدکو",
  "وملل",
  "ثشرق",
  "ثتران",
  "سیستم",
  "مارون",
  "خفناور",
  "خبازرس",
  "توریل",
  "ولپارس",
  "سخوز",
  "واعتبار",
  "پردیس",
  "پارسان",
  "رکیش",
  "وسکاب",
  "ولملت",
  "پی پاد",
  "تملت",
  "ولکار",
  "بورس",
  "تنوین",
  "سنوین",
  "هرمز",
  "شراز",
  "کشرق",
  "رفاه",
  "ودانا",
  "سپ",
  "کنور",
  "کرمان",
  "شبندر",
  "شتوکا",
  "وتوسکا",
  "کتوکا",
  "امین",
  "سدبیر",
  "شتران",
  "زنگان",
  "وسرضوی",
  "وسکرد",
  "وهامون",
  "سیتا",
  "صبا",
  "وسصفا",
  "زکوثر",
  "فزرین",
  "وثنو",
  "وسخراج",
  "ثجوان",
  "تاصیکو",
  "وسکرمان",
  "وسیزد",
  "وسمرکز",
  "وسلرستا",
  "وکبهمن",
  "شستا",
  "وسزنجان",
  "وسهرمز",
  "وساغربی",
  "وایرا",
  "وسخوز",
  "وسفارس",
  "وسبوشهر",
  "وسخراش",
  "آریان",
  "وامیر",
  "ویسا",
  "درازی",
  "وسکرشا",
  "وسگلستا",
  "اعتلا",
  "وسکهبو",
  "دسانکو",
  "سرچشمه",
  "شوینده",
  "پترول",
  "ریشمک",
  "وپویا",
  "واحیا",
  "وسگیلا",
  "شلیا",
  "حپارسا",
  "مفاخر",
  "دتولید",
  "دبالک",
  "قچار",
  "ولقمان",
  "کاسپین",
  "ولانا",
  "وجامی",
  "وثوق",
  "شسپا",
  "غگلستا",
  "ثزاگرس",
  "ثپردیس",
  "وسهمدا",
  "شاوان",
  "شرانل",
  "ثغرب",
  "خراسان",
  "بمپنا",
  "وساربیل",
  "تاپکیش",
  "وساشرقی",
  "قاروم",
  "فارس",
  "پخش",
  "دتوزیع",
  "تاپیکو",
  "ومهان",
  "غگیلا",
  "غفارس",
  "وسیستا",
  "جم",
  "وسمازن",
  "سپیدار",
  "شغدیر",
  "دکپسول",
  "پرداخت",
  "امید",
  "لوتوس",
  "فصبا",
  "زپارس",
  "ساروج",
  "شگویا",
  "شفا",
  "سیدکو",
  "نوری",
  "جم پیلن",
  "پارس",
  "بوعلی",
  "ثجنوب",
  "خعمرا",
  "لطیف",
  "ساینا",
  "چکاپا",
  "حبندر",
  "حسینا",
  "فغدیر",
  "کفرآور",
  "حخزر",
  "ناما",
  "وکادو",
  "وسقم",
  "ثالوند",
  "فروی",
  "وسیلام",
  "خدیزل",
  "ولبهمن",
  "مدیریت",
  "وفتخار",
  "غمینو",
  "تیپیکو",
  "فتوسا",
  "کی بی سی",
  "شبصیر",
  "وخاور",
  "پاکشو",
  "ارفع",
  "ثرود",
  "هجرت",
  "سغدیر",
  "وکغدیر",
  "وشهر",
  "برکت",
  "حآسا",
  "درهآور",
  "کلر",
  "ومشان",
  "سباقر",
  "قاسم",
  "کاوه",
  "بمولد",
  "اتکای",
  "فجهان",
  "مبین",
  "بفجر",
  "بگیلان",
  "کپرور",
  "ما",
  "چخزر",
  "کگهر",
  "کوثر",
  "والماس",
  "وسرمد",
  "وهور",
  "وسپهر",
  "حگهر",
  "وآداک",
  "وامین",
  "فروسیل",
  "گوهران",
  "وسبحان",
  "کیمیا",
  "آریا",
  "غپآذر",
  "اتکام",
  "دماوند",
  "اپال",
  "فرود",
  "شاروم",
  "فافزا",
  "سلار",
  "وسالت",
  "سمتاز",
  "وتعاون",
  "وآیند",
  "حاریا",
  "آرمان",
  "دحاوی",
  "ولراز",
  "کباده",
  "انرژی",
  "فرابورس",
  "کالا",
  "تکنار",
  "توسعه",
  "سخواف",
  "تلیسه",
  "وآفر",
  "کصدف",
  "غدیس",
  "تپولا",
  "حریل",
  "بکهنوج",
  "وآوا",
  "اپرداز",
  "زگلدشت",
  "زماهان",
  "غگلپا",
  "فنفت",
  "آپ",
  "شساخت",
  "اوان",
  "حسیر",
  "تابا",
  "ثنام",
  "ثنور",
  "ثقزوی",
  "وارس",
  "بدکو",
  "وسنا",
  "ولتجار",
  "شجم",
  "ثعتما",
  "ثنظام",
  "زنجان",
  "نیرو",
  "جهرم",
  "فسا",
  "داراب",
  "آینده",
  "بمیلا",
  "دهدشت",
  "سپرده",
  "کیسون",
  "فلات",
  "گکیش",
  "واحصا",
  "شستان",
  "وشمال",
  "فن آوا",
  "شلرد",
  "معیار",
  "ممسنی",
  "کازرو",
  "سجام",
  "غشهداب",
  "ثتوسا",
  "گپارس",
  "وآتوس",
  "خودکفا",
  "خلیبل",
  "وآرین",
  "سیمرغ",
  "آبین",
  "بنو",
  "تبرک",
  "زشگزا",
  "وپسا",
  "زفجر",
  "خفولا",
  "گکوثر",
  "وبرق",
  "نطرین",
  "ولشرق",
  "ومدیر",
  "چدن",
  "بخاور",
  "بجهرم",
  "های وب",
  "اسیاتک",
  "وحکمت",
  "زبینا",
  "زقیام",
  "زفکا",
  "زملارد",
  "کارام",
  "کمینا",
  "مادیرا",
  "حآفرین",
  "غپونه",
  "داوه",
  "خکرمان",
  "بپیوند",
  "فافق",
  "گنگین",
  "فسازان",
  "شهر",
  "فگستر",
  "زکشت",
  "زدشت",
  "بزاگرس",
  "افق",
  "زشریف",
  "رنیک",
  "وهنر",
  "غبهار",
  "غزر",
  "شصدف",
  "کویر",
  "قرن",
  "رافزا",
  "جوین",
  "گشان",
  "آبادا",
  "گدنا",
  "باران",
  "ثبهساز",
  "تماوند",
  "غکورش",
  "ثامید",
  "سپید",
  "کزغال",
  "فزر",
  "کیمیاتک",
  "توسن",
  "قتربت",
  "انتخاب",
  "فکمند",
  "شکام",
  "اردستان",
  "فسبزوار",
  "وطوبی",
  "کتوسعه",
  "بهیر",
  "حشکوه",
  "فسوژ",
  "غدانه",
  "حگردش",
  "تجلی",
  "کایزد",
  "وفردا",
  "بکابل",
  "تپسی",
  "عالیس",
  "پرسپولیس",
  "استقلال",
  "تفارس",
  "اتکاسا",
  "گلدیرا",
  "بازرگام",
  "غمایه",
  "آواپارس",
  "بتهران",
  "کاریز",
  "کرومیت",
  "حپرتو",
  "فن افزار",
  "نیان",
  "تکیمیا",
  "تکاردان",
];
symbols = symbols.slice(0, 5);

let i = 0;
loadChartAndGetData(0);
